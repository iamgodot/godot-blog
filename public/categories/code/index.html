<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Code | Godot&#39;s Blog</title>
<meta name="keywords" content="" />
<meta name="description" content="">
<meta name="author" content="">
<link rel="canonical" href="https://www.iamgodot.com/categories/code/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.d156b151269ca9f254ecd6e4c592b19e37346165a46b1b794368e59b7a6d3f36.css" integrity="sha256-0VaxUSacqfJU7NbkxZKxnjc0YWWkaxt5Q2jlm3ptPzY=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://www.iamgodot.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.iamgodot.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.iamgodot.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://www.iamgodot.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://www.iamgodot.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.83.1" />
<link rel="alternate" type="application/rss+xml" href="https://www.iamgodot.com/categories/code/index.xml">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="list" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.iamgodot.com" accesskey="h" title="Godot&#39;s Blog (Alt + H)">Godot&#39;s Blog</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://www.iamgodot.com/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://www.iamgodot.com/archive/" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://www.iamgodot.com/categories/code/" title="Code">
                    <span class="active">Code</span>
                </a>
            </li>
            <li>
                <a href="https://www.iamgodot.com/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main"> 
<header class="page-header">
  <h1>Code</h1>
</header>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>Use setxkbmap for Keyboard Mapping
    </h2>
  </header>
  <section class="entry-content">
    <p>这是一篇使用（过） Linux Xorg without any DE 以及笔记本外接键盘的人才能理解其中辛酸苦痛的抒情科普文。
TL;DR  外接键盘不要开蓝牙，直接插线，除非你乐意折腾 使用 setxkbmap 而不是 xmodmap 来做 key remapping 不要用 Xorg  The Irrational Part 上午十点零一分，端坐到显示器前，深呼吸两次。
Ok，回滚内核版本之后 Screen Lock 卡死的问题果然消失了，我们继续。
进入系统，先看一下昨晚的日志吧：
... 需求目标： 1. 交换 L-Ctrl &amp; Caps-Lock 2. 交换 Win &amp; Alt 当前方案： 使用 xmodmap 自定义配置文件，在 startx 时执行 已知问题： 1. 系统挂起或蓝牙睡眠导致的 keyboard reconnection 会 reset 掉 Win&amp;Alt 的交换 2. 之后重新执行 xmodmap 会导致 L-Ctrl&amp;Caps-Lock 交换回原状，必须执行两次 后续跟进： 1. TTY console switch 快捷键不可用 2. Terminate X 快捷键 CAB(Ctrl-Alt-Backspace) 不可用 3....</p>
  </section>
  <footer class="entry-footer">October 16, 2021&nbsp;·&nbsp;2 min</footer>
  <a class="entry-link" aria-label="post link to Use setxkbmap for Keyboard Mapping" href="https://www.iamgodot.com/posts/use-setxkbmap-for-keyboard-mapping/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>Use emoji in MySQL
    </h2>
  </header>
  <section class="entry-content">
    <p>最近碰到一个服务器处理请求报错，但是本身的代码逻辑没有问题，排查后发现原来是参数中包含了 emoji，导致向 MySQL 插入数据时失败了。
解决起来倒是不麻烦，因为业务上不要求做相关的支持，所以捕捉异常之后返回错误码也就好了。但是好奇之下，做了个 MySQL 插入 emoji 的实验，发现里面还是有不少门道的。
What’s emoji 🧐 以前的粗浅理解就是由 unicode 支持的表情字符，这次认真查了下，找到了一篇讲解很详尽的文章：Everything you need to know about emoji
根据里面的介绍，关于 emoji 比较官方的解释：
 Emoji are pictographs (pictorial symbols) that are typically presented in a colorful form and used inline in text. They represent things such as faces, weather, vehicles and buildings, food and drink, animals and plants, or icons that represent emotions, feelings, or activities.
 而 emoji 是怎么来的呢：...</p>
  </section>
  <footer class="entry-footer">November 21, 2020&nbsp;·&nbsp;1 min</footer>
  <a class="entry-link" aria-label="post link to Use emoji in MySQL" href="https://www.iamgodot.com/posts/use-emoji-in-mysql/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>The Art of Readable Code
    </h2>
  </header>
  <section class="entry-content">
    <p>最近读了《编写可读代码的艺术》这本书，感觉收获良多。如果早点了解的话，可能以前就不会犯那么多新手错误了，不过话说回来，理论总是要配合实践才能内化成自己的东西，而且书中的内容适合反复温习，一定常读常新。
整本书的核心都在于一个原则：代码应当易于理解。所以作者在开篇就提出了可读性的概念：
 代码的写法应当使别人理解它所需要的时间最小化。
 其中可读性很容易与代码长度混淆，因为代码本身的精简达到一定程度，就难免涉及到晦涩的逻辑压缩和语言用法，而这恰恰是和易读性相悖的。另外代码是写给人看的，这里指的不一定是别人，在实际工作中更有可能是若干天后的自己，所以保证可读性不仅利人，同样利己。 以此为中心，可以发散到编码过程中的很多方面，比如基础的变量命名、代码注释、函数定义以及开发后期的文档维护、解耦重构等等。
One of the hard things  There are only two hard things in Computer Science: cache invalidation and naming things. – Phil Karlton
 这句名言一句道破天机，万物皆从命名始，起名字的能力实在是太重要了。不论是变量常量，还是方法类名，一旦确定名称，代码的整体风格就开始受到影响，并且一直持续下去。
记得刚写代码的时候，并没有觉得合适的变量名称很重要，后来时间长了，慢慢开始琢磨起什么名字好，然后发现换来换去都不合适，为此绞尽脑汁，耗费的时间甚至比开发都长。现在熟练了不少，虽然有时还要再思索几下，但是命名已经比以前清晰很多了。反观周围的同事们，越是高手，在 naming 上也越得心应手，可能这也是编码能力发展的自然规律吧。
书里介绍的各种技巧，基本都围绕在信息量和准确性两点。前者可以保证名称是足够有意义的，同时也在检验变量存在的必要性；而后者能够减少代码中重复或混淆的定义，甚至提供了借助命名 debug 的可能性。
另外让我印象深刻的是，英文单词量有时候也会成为命名能力的瓶颈。比如对于常用的 make 来说，作为动词来描述一个操作可能并不足够清晰，更好的选择可以是 create/generate/setup/compose 等，但是英文不熟练或者词汇量有限的话，就难以在合适的时候想起来，或者要去专门查询才行。不知道未来会不会普及中文编程，不过那样难度仍在，只是从英语课切换成语文课了。
It’s not just about code 在代码里加注释是一件很有争议的事情，因此作者也提到了很重要的一点，要明确什么时候是不需要注释的。好的代码如同优秀的文章，自成一体，但这不影响添加一些额外的说明和解释可以提高阅读理解的效率。
广义上想，注释其实也算是另一种形式的文档。一行代码的注释，对象换成函数方法、模块文件或整个工程的话，就会演变成文字片段、README 甚至是单独的 DOCBOOK。而这些对于不需要了解逻辑细节的人来说，是比代码本身更高效的入口。
回想自己在工作日常中，写文档的时间并不比开发少，但两者其实并不冲突，归根到底都是要把任务描述清楚，一个写给人，另外一个给机器。代码写得清晰，文档维护也会非常轻松。
而在其他的场景中，比如开源的工具库，使用者对文档的关注度会更高，一方面会从文档的质量上评判整个项目，另一方面在使用中大部分情况也是阅读文档，而非源代码。
Be wise, not smart 每种编程语言都少不了流程控制的部分，再加上特有的语法糖，想写出精巧的代码并不是难事。 Oneliner 非但不难，还很容易有成就感，尤其是成功地把冗长的逻辑压缩在一行空间内。
但是这种做法的后果可能是灾难性的。抛开可读性原则不谈，这样的写法在新增 feature 和 debug 时会带来额外的成本，尤其是后者。因为排查错误的时候往往需要快速的定位和修复，而碰上复杂的条件分支和循环语句时，一是逻辑拆解浪费时间，再者想做改动也可能很困难，因为代码已经变得像个精 致的花瓶，一碰就碎了。
不得不说没有实际的经历，很难体会到这里面的道理，看似矛盾，实则展现了一个 coder 的成长过程：一开始专注于逻辑堆叠，后期追求奇技淫巧的写法，最终回归质朴的实现方式。...</p>
  </section>
  <footer class="entry-footer">October 31, 2020&nbsp;·&nbsp;1 min</footer>
  <a class="entry-link" aria-label="post link to The Art of Readable Code" href="https://www.iamgodot.com/posts/the-art-of-readable-code/"></a>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2021 <a href="https://www.iamgodot.com">Godot&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><footer class="footer">
    <span>
        <a href="http://beian.miit.gov.cn/" target="_blank">京ICP备20005558号-2</a>
    </span>
</footer>


<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
